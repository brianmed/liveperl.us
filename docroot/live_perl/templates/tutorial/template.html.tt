[% UNLESS previous %]
<!DOCTYPE HTML>
<html>
<head>
    <meta HTTP-EQUIV="CACHE-CONTROL" CONTENT="NO-CACHE">
    <meta HTTP-EQUIV="PRAGMA" CONTENT="NO-CACHE">
    <meta http-Equiv="Expires" Content="0">

    <script src="/jquery-1.9.1.js"></script>

    <link rel="stylesheet" href="/codemirror-3.1/lib/codemirror.css">
    <script src="/codemirror-3.1/lib/codemirror.js"></script>
    <script src="/codemirror-3.1/mode/perl/perl.js"></script>
    <link rel="stylesheet" href="/codemirror-3.1/doc/docs.css">
    <link rel="stylesheet" href="/bootstrap/css/bootstrap.css">
    <script src="/bootstrap/js/bootstrap.js"></script>
</head>
<body>

    [% INCLUDE navbar.html.tt %]
[% END %]

    [% IF progress %]
        <div id=progress>
        <h1>Building docker image... please wait</h1>
        </div>
         [% STOP %]
    [% END %]

    [% IF previous %]
    <script>
        $('#progress').remove();
    </script>
    [% END %]

    [% IF subtitle %]
    <h1>Perl Source: [% subtitle %]</h1>
    [% END %]

    [% IF error %]
        <div class="alert alert-warning">[% error %]<div>
        </body>
        </html>
         [% STOP %]
    [% END %]

    [% html %]

  <form method=post>
    <textarea id=code name=code class="field span12" rows=20>[% code %]</textarea>

    <br>

      [% IF output %]
            <pre class="pre-scrollable">[% output | html %]</pre>
      [% END %]

      <button type="submit" class="btn btn-primary">Save</button>
      <a class="btn btn-default" href="http://liveperl.us:[% port %]/" target=code>Live code</a>
  </form>

    <style type="text/css">.CodeMirror {border-top: 1px solid black; border-bottom: 1px solid black;}</style>

    <style type="text/css">
    body {
        padding-top: 60px;
        padding-bottom: 40px;
    }
    </style>

    <script>
      var editor = CodeMirror.fromTextArea(document.getElementById("code"), {
        lineNumbers: true
      });
      editor.setSize("100%", "550")
    </script>

    <script>
      document.domain = document.domain;
    </script>

    <div id=content>
        Waiting for content.
    </div>
    
    <script>
        // Give morbo time to relaod
        setTimeout(function() {
            $("#content").html('<iframe src="http://liveperl.us:[% port %]/" name="output" style="height:300px; width:100%;"></iframe>');
        }, 3000);
    </script>
</body>
</html>
